"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8340],{3376:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Infrastructure/kubernetes-cluster","title":"Kubernetes Cluster Setup","description":"Learn how to set up a production-ready Kubernetes cluster with kubeadm, including prerequisites, control plane initialization, and worker node joining.","source":"@site/docs/Infrastructure/kubernetes-cluster.md","sourceDirName":"Infrastructure","slug":"/Infrastructure/KubernetesCluster","permalink":"/docs/docs/Infrastructure/KubernetesCluster","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Infrastructure/kubernetes-cluster.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Kubernetes Cluster Setup","description":"Learn how to set up a production-ready Kubernetes cluster with kubeadm, including prerequisites, control plane initialization, and worker node joining.","slug":"/Infrastructure/KubernetesCluster","keywords":["Kubernetes cluster","kubeadm","CRI-O runtime","Calico networking","cluster setup","container orchestration"]},"sidebar":"tutorialSidebar","previous":{"title":"Ingress NGINX Controller","permalink":"/docs/docs/Infrastructure/IngressNginx"},"next":{"title":"Cert-Manager","permalink":"/docs/docs/Infrastructure/CertManager"}}');var r=t(4848),i=t(8453);const o={sidebar_position:1,title:"Kubernetes Cluster Setup",description:"Learn how to set up a production-ready Kubernetes cluster with kubeadm, including prerequisites, control plane initialization, and worker node joining.",slug:"/Infrastructure/KubernetesCluster",keywords:["Kubernetes cluster","kubeadm","CRI-O runtime","Calico networking","cluster setup","container orchestration"]},l="\u2638\ufe0f Kubernetes Cluster Setup with kubeadm",a={},c=[{value:"\ud83d\udd27 Prerequisites (All Nodes)",id:"-prerequisites-all-nodes",level:2},{value:"\ud83d\udc33 Install CRI-O Runtime",id:"-install-cri-o-runtime",level:2},{value:"\u2638\ufe0f Install Kubernetes Components",id:"\ufe0f-install-kubernetes-components",level:2},{value:"\ud83c\udfaf Initialize Control Plane",id:"-initialize-control-plane",level:2},{value:"\ud83c\udf10 Install Calico Network Plugin",id:"-install-calico-network-plugin",level:2},{value:"\ud83d\udc65 Join Worker Nodes",id:"-join-worker-nodes",level:2},{value:"\u25b6\ufe0f Sample Output",id:"\ufe0f-sample-output",level:2},{value:"\ud83d\udcca Install Metrics Server",id:"-install-metrics-server",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\ufe0f-kubernetes-cluster-setup-with-kubeadm",children:"\u2638\ufe0f Kubernetes Cluster Setup with kubeadm"})}),"\n",(0,r.jsxs)(n.p,{children:["Learn how to set up a ",(0,r.jsx)(n.strong,{children:"production-ready Kubernetes cluster"})," using ",(0,r.jsx)(n.strong,{children:"kubeadm"})," with ",(0,r.jsx)(n.strong,{children:"CRI-O runtime"})," and ",(0,r.jsx)(n.strong,{children:"Calico networking"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-prerequisites-all-nodes",children:"\ud83d\udd27 Prerequisites (All Nodes)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Enable iptables bridged traffic:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf\nbr_netfilter\noverlay\nEOF\n\nsudo modprobe br_netfilter\nsudo modprobe overlay\n\ncat <<EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nEOF\n\nsudo sysctl --system\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Disable swap:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo swapoff -a\n(crontab -l 2>/dev/null; echo "@reboot /sbin/swapoff -a") | crontab - || true\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-install-cri-o-runtime",children:"\ud83d\udc33 Install CRI-O Runtime"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Install CRI-O container runtime:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo apt-get update -y\nsudo apt-get install -y software-properties-common curl apt-transport-https ca-certificates\n\ncurl -fsSL https://pkgs.k8s.io/addons:/cri-o:/prerelease:/main/deb/Release.key | \\\n    gpg --dearmor -o /etc/apt/keyrings/cri-o-apt-keyring.gpg\n\necho "deb [signed-by=/etc/apt/keyrings/cri-o-apt-keyring.gpg] https://pkgs.k8s.io/addons:/cri-o:/prerelease:/main/deb/ /" | \\\n    tee /etc/apt/sources.list.d/cri-o.list\n\nsudo apt-get update -y\nsudo apt-get install -y cri-o\n\nsudo systemctl daemon-reload\nsudo systemctl enable crio --now\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-install-kubernetes-components",children:"\u2638\ufe0f Install Kubernetes Components"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Install kubeadm, kubelet, kubectl:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo mkdir -p /etc/apt/keyrings\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key | \\\n    sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n\necho "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.31/deb/ /" | \\\n    sudo tee /etc/apt/sources.list.d/kubernetes.list\n\nsudo apt update\nsudo apt-get install -y kubelet=1.31.1-1.1 kubectl=1.31.1-1.1 kubeadm=1.31.1-1.1\nsudo apt-mark hold kubelet kubeadm kubectl\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Configure kubelet:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo apt-get install -y jq\nlocal_ip="$(ip --json addr show eth0 | jq -r \'.[0].addr_info[] | select(.family == "inet") | .local\')"\ncat > /etc/default/kubelet << EOF\nKUBELET_EXTRA_ARGS=--node-ip=$local_ip\nEOF\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-initialize-control-plane",children:"\ud83c\udfaf Initialize Control Plane"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Initialize cluster (Control Plane Node):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm init --pod-network-cidr=192.168.0.0/16 --apiserver-advertise-address=$local_ip\n\n# Configure kubectl\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-install-calico-network-plugin",children:"\ud83c\udf10 Install Calico Network Plugin"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Deploy Calico CNI:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml\n\n# Verify pods\nkubectl get pods -n kube-system\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-join-worker-nodes",children:"\ud83d\udc65 Join Worker Nodes"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Get join command from control plane:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubeadm token create --print-join-command\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Run on worker nodes:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm join <CONTROL_PLANE_IP>:6443 --token <TOKEN> --discovery-token-ca-cert-hash sha256:<HASH>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-sample-output",children:"\u25b6\ufe0f Sample Output"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ kubectl get nodes\nNAME                   STATUS   ROLES           AGE   VERSION\ncontrol-plane          Ready    control-plane   10m   v1.31.1\nworker-node-1          Ready    <none>          5m    v1.31.1\nworker-node-2          Ready    <none>          5m    v1.31.1\n\n$ kubectl get pods -n kube-system\nNAME                                       READY   STATUS    RESTARTS   AGE\ncalico-kube-controllers-6879d4fcdc-s8v94   1/1     Running   0          8m\ncalico-node-4v2v8                          1/1     Running   0          8m\ncoredns-7c65d6cfc9-qf5x9                   1/1     Running   0          10m\netcd-control-plane                         1/1     Running   0          10m\nkube-apiserver-control-plane               1/1     Running   0          10m\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-install-metrics-server",children:"\ud83d\udcca Install Metrics Server"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Deploy metrics server:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/techiescamp/kubeadm-scripts/main/manifests/metrics-server.yaml\n\n# Verify metrics\nkubectl top nodes\nkubectl top pods -n kube-system\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Reference:"})," ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/",children:"Kubernetes Documentation"})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var s=t(6540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);