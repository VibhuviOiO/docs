"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4136],{1385:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Testing-Scanning/SAST/codeql","title":"CodeQL","description":"CodeQL is GitHub\'s semantic code analysis engine for finding security vulnerabilities. Learn how to use CodeQL for automated security scanning and custom query development.","source":"@site/docs/Testing-Scanning/SAST/codeql.md","sourceDirName":"Testing-Scanning/SAST","slug":"/TestingScanning/CodeQL","permalink":"/docs/docs/TestingScanning/CodeQL","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Testing-Scanning/SAST/codeql.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"CodeQL","description":"CodeQL is GitHub\'s semantic code analysis engine for finding security vulnerabilities. Learn how to use CodeQL for automated security scanning and custom query development.","slug":"/TestingScanning/CodeQL","keywords":["CodeQL","GitHub security","semantic code analysis","SAST","security vulnerabilities","code scanning","GitHub Advanced Security","custom queries","security research","vulnerability detection"]},"sidebar":"tutorialSidebar","previous":{"title":"Checkmarx SAST","permalink":"/docs/docs/TestingScanning/Checkmarx"},"next":{"title":"\ud83d\udd12 Bandit - Python Security Linter","permalink":"/docs/docs/Testing-Scanning/SAST/bandit"}}');var r=t(4848),a=t(8453);const i={sidebar_position:4,title:"CodeQL",description:"CodeQL is GitHub's semantic code analysis engine for finding security vulnerabilities. Learn how to use CodeQL for automated security scanning and custom query development.",slug:"/TestingScanning/CodeQL",keywords:["CodeQL","GitHub security","semantic code analysis","SAST","security vulnerabilities","code scanning","GitHub Advanced Security","custom queries","security research","vulnerability detection"]},o="\ud83d\ude80 Semantic Security Analysis with GitHub CodeQL",l={},c=[{value:"\ud83e\uddf0 Prerequisites",id:"-prerequisites",level:2},{value:"\ud83d\udd27 Step 1: Setup CodeQL CLI",id:"-step-1-setup-codeql-cli",level:2},{value:"Install CodeQL CLI",id:"install-codeql-cli",level:3},{value:"Setup CodeQL Database",id:"setup-codeql-database",level:3},{value:"\ud83c\udfd7\ufe0f Step 2: Basic CodeQL Analysis",id:"\ufe0f-step-2-basic-codeql-analysis",level:2},{value:"Run Standard Security Queries",id:"run-standard-security-queries",level:3},{value:"PowerShell Analysis Script",id:"powershell-analysis-script",level:3},{value:"\u25b6\ufe0f Step 3: GitHub Actions Integration",id:"\ufe0f-step-3-github-actions-integration",level:2},{value:"CodeQL Workflow",id:"codeql-workflow",level:3},{value:"CodeQL Configuration",id:"codeql-configuration",level:3},{value:"\ud83d\udcca Step 4: Custom CodeQL Queries",id:"-step-4-custom-codeql-queries",level:2},{value:"Custom Security Query",id:"custom-security-query",level:3},{value:"SQL Injection Detection Query",id:"sql-injection-detection-query",level:3},{value:"Cross-Site Scripting (XSS) Query",id:"cross-site-scripting-xss-query",level:3},{value:"\ud83d\udd0d Step 5: Advanced CodeQL Analysis",id:"-step-5-advanced-codeql-analysis",level:2},{value:"Batch Analysis Script",id:"batch-analysis-script",level:3},{value:"Batch Configuration Example",id:"batch-configuration-example",level:3},{value:"\ud83d\udccb Common Use Cases",id:"-common-use-cases",level:2},{value:"1. <strong>Security Research</strong>",id:"1-security-research",level:3},{value:"2. <strong>Enterprise Security</strong>",id:"2-enterprise-security",level:3},{value:"3. <strong>DevSecOps Integration</strong>",id:"3-devsecops-integration",level:3},{value:"4. <strong>Code Quality Assurance</strong>",id:"4-code-quality-assurance",level:3},{value:"\u2705 What You&#39;ll Achieve",id:"-what-youll-achieve",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"-semantic-security-analysis-with-github-codeql",children:"\ud83d\ude80 Semantic Security Analysis with GitHub CodeQL"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CodeQL"})," is GitHub's ",(0,r.jsx)(n.strong,{children:"semantic code analysis engine"})," that treats code as data to find ",(0,r.jsx)(n.strong,{children:"security vulnerabilities"})," and ",(0,r.jsx)(n.strong,{children:"coding errors"}),". Perfect for ",(0,r.jsx)(n.strong,{children:"advanced security research"}),", ",(0,r.jsx)(n.strong,{children:"custom vulnerability detection"}),", and ",(0,r.jsx)(n.strong,{children:"automated security scanning"})," with powerful ",(0,r.jsx)(n.strong,{children:"query language"})," capabilities."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-prerequisites",children:"\ud83e\uddf0 Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"Make sure you have the following:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GitHub repository"})," with CodeQL enabled"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CodeQL CLI"})," installed (for local analysis)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Visual Studio Code"})," with CodeQL extension (optional)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Basic understanding"})," of programming languages"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Git"})," for version control"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-step-1-setup-codeql-cli",children:"\ud83d\udd27 Step 1: Setup CodeQL CLI"}),"\n",(0,r.jsx)(n.h3,{id:"install-codeql-cli",children:"Install CodeQL CLI"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Download CodeQL CLI bundle\n# Linux/macOS\nwget https://github.com/github/codeql-cli-binaries/releases/latest/download/codeql-linux64.zip\nunzip codeql-linux64.zip\n\n# macOS (using Homebrew)\nbrew install codeql\n\n# Windows\n# Download from: https://github.com/github/codeql-cli-binaries/releases/latest\n\n# Add to PATH\nexport PATH="$PATH:/path/to/codeql"\n\n# Verify installation\ncodeql version\n'})}),"\n",(0,r.jsx)(n.h3,{id:"setup-codeql-database",children:"Setup CodeQL Database"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Clone CodeQL standard library\ngit clone https://github.com/github/codeql.git codeql-repo\n\n# Create CodeQL database for your project\ncodeql database create my-app-db \\\n  --language=javascript \\\n  --source-root=./src \\\n  --command="npm run build"\n\n# For multiple languages\ncodeql database create my-app-db \\\n  --language=javascript,python,java \\\n  --source-root=. \\\n  --command="npm install && npm run build"\n\n# List available languages\ncodeql resolve languages\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-step-2-basic-codeql-analysis",children:"\ud83c\udfd7\ufe0f Step 2: Basic CodeQL Analysis"}),"\n",(0,r.jsx)(n.h3,{id:"run-standard-security-queries",children:"Run Standard Security Queries"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Run all security queries for JavaScript\ncodeql database analyze my-app-db \\\n  codeql-repo/javascript/ql/src/Security \\\n  --format=sarif-latest \\\n  --output=results.sarif\n\n# Run specific query suites\ncodeql database analyze my-app-db \\\n  codeql-repo/javascript/ql/src/codeql-suites/javascript-security-and-quality.qls \\\n  --format=sarif-latest \\\n  --output=security-results.sarif\n\n# Run queries for multiple languages\ncodeql database analyze my-app-db \\\n  codeql-repo/javascript/ql/src/codeql-suites/javascript-security-extended.qls \\\n  codeql-repo/python/ql/src/codeql-suites/python-security-and-quality.qls \\\n  --format=sarif-latest \\\n  --output=multi-lang-results.sarif\n\n# Generate CSV output\ncodeql database analyze my-app-db \\\n  codeql-repo/javascript/ql/src/Security \\\n  --format=csv \\\n  --output=results.csv\n"})}),"\n",(0,r.jsx)(n.h3,{id:"powershell-analysis-script",children:"PowerShell Analysis Script"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Create codeql-analysis.ps1:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:'#!/usr/bin/env pwsh\n\nparam(\n    [Parameter(Mandatory=$true)]\n    [string]$SourcePath,\n    \n    [Parameter(Mandatory=$true)]\n    [string]$Language,\n    \n    [Parameter(Mandatory=$false)]\n    [string]$DatabaseName = "codeql-db",\n    \n    [Parameter(Mandatory=$false)]\n    [string]$BuildCommand = "",\n    \n    [Parameter(Mandatory=$false)]\n    [string]$QuerySuite = "security-and-quality",\n    \n    [Parameter(Mandatory=$false)]\n    [string]$OutputPath = "./codeql-results"\n)\n\n# Create output directory\nif (-not (Test-Path $OutputPath)) {\n    New-Item -Path $OutputPath -ItemType Directory -Force\n}\n\nWrite-Host "Starting CodeQL analysis..." -ForegroundColor Green\nWrite-Host "Source: $SourcePath" -ForegroundColor Cyan\nWrite-Host "Language: $Language" -ForegroundColor Cyan\nWrite-Host "Database: $DatabaseName" -ForegroundColor Cyan\n\ntry {\n    # Step 1: Create CodeQL database\n    Write-Host "`nStep 1: Creating CodeQL database..." -ForegroundColor Yellow\n    \n    $CreateArgs = @(\n        "database", "create", $DatabaseName,\n        "--language=$Language",\n        "--source-root=$SourcePath"\n    )\n    \n    if ($BuildCommand) {\n        $CreateArgs += "--command=$BuildCommand"\n    }\n    \n    & codeql @CreateArgs\n    \n    if ($LASTEXITCODE -ne 0) {\n        throw "Failed to create CodeQL database"\n    }\n    \n    Write-Host "\u2705 Database created successfully" -ForegroundColor Green\n    \n    # Step 2: Run analysis\n    Write-Host "`nStep 2: Running CodeQL analysis..." -ForegroundColor Yellow\n    \n    $QueryPath = switch ($Language) {\n        "javascript" { "codeql-repo/javascript/ql/src/codeql-suites/javascript-$QuerySuite.qls" }\n        "python" { "codeql-repo/python/ql/src/codeql-suites/python-$QuerySuite.qls" }\n        "java" { "codeql-repo/java/ql/src/codeql-suites/java-$QuerySuite.qls" }\n        "csharp" { "codeql-repo/csharp/ql/src/codeql-suites/csharp-$QuerySuite.qls" }\n        "cpp" { "codeql-repo/cpp/ql/src/codeql-suites/cpp-$QuerySuite.qls" }\n        "go" { "codeql-repo/go/ql/src/codeql-suites/go-$QuerySuite.qls" }\n        default { throw "Unsupported language: $Language" }\n    }\n    \n    # Run analysis with multiple output formats\n    $AnalyzeArgs = @(\n        "database", "analyze", $DatabaseName,\n        $QueryPath,\n        "--format=sarif-latest",\n        "--output=$OutputPath/results.sarif"\n    )\n    \n    & codeql @AnalyzeArgs\n    \n    if ($LASTEXITCODE -ne 0) {\n        throw "Failed to run CodeQL analysis"\n    }\n    \n    # Generate additional formats\n    & codeql database analyze $DatabaseName $QueryPath --format=csv --output="$OutputPath/results.csv"\n    & codeql database analyze $DatabaseName $QueryPath --format=json --output="$OutputPath/results.json"\n    \n    Write-Host "\u2705 Analysis completed successfully" -ForegroundColor Green\n    \n    # Step 3: Parse and display results\n    Write-Host "`nStep 3: Processing results..." -ForegroundColor Yellow\n    \n    if (Test-Path "$OutputPath/results.sarif") {\n        $SarifContent = Get-Content "$OutputPath/results.sarif" | ConvertFrom-Json\n        \n        $TotalResults = 0\n        $ResultsBySeverity = @{\n            "error" = 0\n            "warning" = 0\n            "note" = 0\n        }\n        \n        foreach ($run in $SarifContent.runs) {\n            foreach ($result in $run.results) {\n                $TotalResults++\n                $level = $result.level\n                if ($ResultsBySeverity.ContainsKey($level)) {\n                    $ResultsBySeverity[$level]++\n                }\n            }\n        }\n        \n        Write-Host "`nCodeQL Analysis Results:" -ForegroundColor Magenta\n        Write-Host "Total Issues: $TotalResults" -ForegroundColor White\n        Write-Host "Errors: $($ResultsBySeverity.error)" -ForegroundColor Red\n        Write-Host "Warnings: $($ResultsBySeverity.warning)" -ForegroundColor Yellow\n        Write-Host "Notes: $($ResultsBySeverity.note)" -ForegroundColor Cyan\n        \n        # Display top issues\n        Write-Host "`nTop Issues Found:" -ForegroundColor Yellow\n        $IssueCount = 0\n        foreach ($run in $SarifContent.runs) {\n            foreach ($result in $run.results) {\n                if ($IssueCount -ge 5) { break }\n                \n                $ruleId = $result.ruleId\n                $message = $result.message.text\n                $level = $result.level\n                $location = $result.locations[0].physicalLocation.artifactLocation.uri\n                $line = $result.locations[0].physicalLocation.region.startLine\n                \n                Write-Host "  [$level] $ruleId" -ForegroundColor $(if ($level -eq "error") { "Red" } elseif ($level -eq "warning") { "Yellow" } else { "Cyan" })\n                Write-Host "    $message" -ForegroundColor Gray\n                Write-Host "    Location: $location:$line" -ForegroundColor Gray\n                Write-Host ""\n                \n                $IssueCount++\n            }\n            if ($IssueCount -ge 5) { break }\n        }\n        \n        # Check for critical issues\n        if ($ResultsBySeverity.error -gt 0) {\n            Write-Warning "Found $($ResultsBySeverity.error) critical security issues!"\n            exit 1\n        }\n    }\n    \n    Write-Host "\u2705 CodeQL analysis completed successfully!" -ForegroundColor Green\n    Write-Host "Results saved to: $OutputPath" -ForegroundColor Cyan\n    \n} catch {\n    Write-Error "CodeQL analysis failed: $($_.Exception.Message)"\n    exit 1\n} finally {\n    # Cleanup database if needed\n    if (Test-Path $DatabaseName) {\n        Write-Host "Cleaning up database..." -ForegroundColor Gray\n        Remove-Item -Path $DatabaseName -Recurse -Force\n    }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-step-3-github-actions-integration",children:"\u25b6\ufe0f Step 3: GitHub Actions Integration"}),"\n",(0,r.jsx)(n.h3,{id:"codeql-workflow",children:"CodeQL Workflow"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Create .github/workflows/codeql-analysis.yml:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'name: "CodeQL Security Analysis"\n\non:\n  push:\n    branches: [ main, develop ]\n  pull_request:\n    branches: [ main ]\n  schedule:\n    - cron: \'0 2 * * 1\'  # Weekly on Monday at 2 AM\n\njobs:\n  analyze:\n    name: Analyze Code\n    runs-on: ubuntu-latest\n    permissions:\n      actions: read\n      contents: read\n      security-events: write\n\n    strategy:\n      fail-fast: false\n      matrix:\n        language: [ \'javascript\', \'python\' ]\n        # Supported languages: \'cpp\', \'csharp\', \'go\', \'java\', \'javascript\', \'python\'\n\n    steps:\n    - name: Checkout repository\n      uses: actions/checkout@v3\n\n    - name: Initialize CodeQL\n      uses: github/codeql-action/init@v2\n      with:\n        languages: ${{ matrix.language }}\n        # Override default queries with custom query suite\n        queries: +security-and-quality,security-extended\n        # Custom configuration file\n        config-file: ./.github/codeql/codeql-config.yml\n\n    - name: Setup Node.js (for JavaScript)\n      if: matrix.language == \'javascript\'\n      uses: actions/setup-node@v3\n      with:\n        node-version: \'18\'\n        cache: \'npm\'\n\n    - name: Setup Python (for Python)\n      if: matrix.language == \'python\'\n      uses: actions/setup-python@v4\n      with:\n        python-version: \'3.9\'\n        cache: \'pip\'\n\n    - name: Install dependencies\n      run: |\n        if [ "${{ matrix.language }}" == "javascript" ]; then\n          npm ci\n        elif [ "${{ matrix.language }}" == "python" ]; then\n          pip install -r requirements.txt\n        fi\n\n    - name: Autobuild\n      uses: github/codeql-action/autobuild@v2\n      # Alternative: Manual build steps\n      # - name: Manual build\n      #   run: |\n      #     npm run build\n\n    - name: Perform CodeQL Analysis\n      uses: github/codeql-action/analyze@v2\n      with:\n        category: "/language:${{matrix.language}}"\n        # Upload results to GitHub Security tab\n        upload: true\n        # Fail the job if vulnerabilities are found\n        # fail-on: error\n\n    - name: Upload SARIF results\n      uses: actions/upload-artifact@v3\n      if: always()\n      with:\n        name: codeql-results-${{ matrix.language }}\n        path: /home/runner/work/_temp/codeql_databases/*/results/*.sarif\n        retention-days: 30\n\n    - name: Process Results\n      if: always()\n      run: |\n        # Download and process SARIF results\n        echo "Processing CodeQL results..."\n        \n        # Find SARIF files\n        SARIF_FILES=$(find /home/runner/work/_temp/codeql_databases/ -name "*.sarif" 2>/dev/null || echo "")\n        \n        if [ -n "$SARIF_FILES" ]; then\n          for sarif_file in $SARIF_FILES; do\n            echo "Processing: $sarif_file"\n            \n            # Extract key metrics using jq\n            if command -v jq >/dev/null 2>&1; then\n              TOTAL_RESULTS=$(jq \'[.runs[].results | length] | add // 0\' "$sarif_file")\n              ERROR_COUNT=$(jq \'[.runs[].results[] | select(.level == "error")] | length\' "$sarif_file")\n              WARNING_COUNT=$(jq \'[.runs[].results[] | select(.level == "warning")] | length\' "$sarif_file")\n              \n              echo "## CodeQL Results for ${{ matrix.language }}" >> $GITHUB_STEP_SUMMARY\n              echo "- Total Issues: $TOTAL_RESULTS" >> $GITHUB_STEP_SUMMARY\n              echo "- Errors: $ERROR_COUNT" >> $GITHUB_STEP_SUMMARY\n              echo "- Warnings: $WARNING_COUNT" >> $GITHUB_STEP_SUMMARY\n              echo "" >> $GITHUB_STEP_SUMMARY\n              \n              # Set outputs for other jobs\n              echo "total_results=$TOTAL_RESULTS" >> $GITHUB_OUTPUT\n              echo "error_count=$ERROR_COUNT" >> $GITHUB_OUTPUT\n              echo "warning_count=$WARNING_COUNT" >> $GITHUB_OUTPUT\n            fi\n          done\n        else\n          echo "No SARIF files found"\n        fi\n'})}),"\n",(0,r.jsx)(n.h3,{id:"codeql-configuration",children:"CodeQL Configuration"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Create .github/codeql/codeql-config.yml:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'name: "CodeQL Configuration"\n\n# Disable default queries and specify custom ones\ndisable-default-queries: false\n\n# Additional query packs to run\npacks:\n  - codeql/javascript-queries:AlertSuppression.ql\n  - codeql/javascript-queries:Security\n  - codeql/python-queries:Security\n\n# Custom queries\nqueries:\n  - name: Custom security queries\n    uses: ./.github/codeql/custom-queries/\n\n# Path filters\npaths-ignore:\n  - "node_modules/**"\n  - "vendor/**"\n  - "dist/**"\n  - "build/**"\n  - "**/*.min.js"\n  - "**/*.bundle.js"\n  - "test/**"\n  - "tests/**"\n  - "**/*.test.js"\n  - "**/*.spec.js"\n\npaths:\n  - "src/**"\n  - "lib/**"\n  - "app/**"\n\n# Language-specific configuration\njavascript:\n  # Include TypeScript files\n  extensions:\n    - .js\n    - .jsx\n    - .ts\n    - .tsx\n    - .vue\n  \n  # Exclude test files\n  exclude:\n    - "**/*.test.*"\n    - "**/*.spec.*"\n    - "**/test/**"\n    - "**/tests/**"\n\npython:\n  # Python-specific settings\n  extensions:\n    - .py\n  \n  # Setup commands for Python dependencies\n  setup-python-dependencies: true\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-step-4-custom-codeql-queries",children:"\ud83d\udcca Step 4: Custom CodeQL Queries"}),"\n",(0,r.jsx)(n.h3,{id:"custom-security-query",children:"Custom Security Query"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Create .github/codeql/custom-queries/hardcoded-secrets.ql:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ql",children:'/**\n * @name Hardcoded secrets in source code\n * @description Finds potential hardcoded secrets like API keys, passwords, and tokens\n * @kind problem\n * @problem.severity error\n * @security-severity 8.5\n * @precision high\n * @id custom/hardcoded-secrets\n * @tags security\n *       external/cwe/cwe-798\n */\n\nimport javascript\n\n/**\n * A string literal that might contain a hardcoded secret\n */\nclass PotentialSecret extends StringLiteral {\n  PotentialSecret() {\n    // Look for common secret patterns\n    this.getValue().regexpMatch("(?i).*(api[_-]?key|password|secret|token|auth|credential).*") and\n    // Must be at least 8 characters long\n    this.getValue().length() > 8 and\n    // Exclude obvious test/example values\n    not this.getValue().regexpMatch("(?i).*(test|example|demo|placeholder|your[_-]?key).*") and\n    // Must contain some complexity (letters and numbers/symbols)\n    this.getValue().regexpMatch(".*[a-zA-Z].*[0-9].*") or\n    this.getValue().regexpMatch(".*[a-zA-Z].*[^a-zA-Z0-9].*")\n  }\n}\n\n/**\n * An assignment where a potential secret is assigned to a variable\n */\nclass SecretAssignment extends AssignmentExpr {\n  SecretAssignment() {\n    this.getRhs() instanceof PotentialSecret\n  }\n  \n  string getVariableName() {\n    result = this.getLhs().(VarAccess).getName()\n  }\n}\n\n/**\n * A property assignment where a potential secret is assigned\n */\nclass SecretPropertyAssignment extends Property {\n  SecretPropertyAssignment() {\n    this.getInit() instanceof PotentialSecret\n  }\n  \n  string getPropertyName() {\n    result = this.getName()\n  }\n}\n\nfrom ASTNode secretLocation, string secretType, string message\nwhere\n  (\n    secretLocation instanceof SecretAssignment and\n    secretType = "Variable Assignment" and\n    message = "Potential hardcoded secret in variable: " + secretLocation.(SecretAssignment).getVariableName()\n  ) or\n  (\n    secretLocation instanceof SecretPropertyAssignment and\n    secretType = "Property Assignment" and\n    message = "Potential hardcoded secret in property: " + secretLocation.(SecretPropertyAssignment).getPropertyName()\n  ) or\n  (\n    secretLocation instanceof PotentialSecret and\n    not exists(SecretAssignment sa | sa.getRhs() = secretLocation) and\n    not exists(SecretPropertyAssignment spa | spa.getInit() = secretLocation) and\n    secretType = "String Literal" and\n    message = "Potential hardcoded secret in string literal"\n  )\nselect secretLocation, message\n'})}),"\n",(0,r.jsx)(n.h3,{id:"sql-injection-detection-query",children:"SQL Injection Detection Query"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Create .github/codeql/custom-queries/sql-injection.ql:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ql",children:'/**\n * @name SQL injection vulnerability\n * @description Finds potential SQL injection vulnerabilities in database queries\n * @kind path-problem\n * @problem.severity error\n * @security-severity 9.0\n * @precision high\n * @id custom/sql-injection\n * @tags security\n *       external/cwe/cwe-89\n */\n\nimport javascript\nimport semmle.javascript.security.dataflow.SqlInjectionQuery\nimport DataFlow::PathGraph\n\n/**\n * A taint-tracking configuration for SQL injection vulnerabilities\n */\nclass SqlInjectionConfig extends TaintTracking::Configuration {\n  SqlInjectionConfig() { this = "SqlInjectionConfig" }\n\n  override predicate isSource(DataFlow::Node source) {\n    // User input sources\n    source instanceof RemoteFlowSource or\n    source instanceof ClientSideRemoteFlowSource or\n    // HTTP request parameters\n    exists(HTTP::RequestInputAccess req | source = req) or\n    // URL parameters\n    exists(UrlSearchParams usp | source = usp.getAMethodCall("get"))\n  }\n\n  override predicate isSink(DataFlow::Node sink) {\n    // Database query sinks\n    sink instanceof SqlInjection::Sink or\n    // String concatenation that builds SQL queries\n    exists(AddExpr add |\n      add.getAnOperand().getStringValue().regexpMatch("(?i).*(select|insert|update|delete|drop|create|alter).*") and\n      sink.asExpr() = add.getAnOperand()\n    ) or\n    // Template literals used in SQL contexts\n    exists(TemplateLiteral tl |\n      tl.getStringValue().regexpMatch("(?i).*(select|insert|update|delete|drop|create|alter).*") and\n      sink.asExpr() = tl.getAnElement()\n    )\n  }\n\n  override predicate isSanitizer(DataFlow::Node node) {\n    // Parameterized queries are safe\n    exists(MethodCallExpr call |\n      call.getMethodName() = "query" and\n      call.getNumArgument() >= 2 and\n      node.asExpr() = call.getArgument(1)\n    ) or\n    // Escaped values\n    exists(MethodCallExpr call |\n      call.getMethodName().regexpMatch("escape|sanitize|clean") and\n      node.asExpr() = call\n    )\n  }\n}\n\nfrom SqlInjectionConfig config, DataFlow::PathNode source, DataFlow::PathNode sink\nwhere config.hasFlowPath(source, sink)\nselect sink.getNode(), source, sink,\n  "This SQL query depends on a $@, which could allow SQL injection.",\n  source.getNode(), "user-provided value"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"cross-site-scripting-xss-query",children:"Cross-Site Scripting (XSS) Query"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Create .github/codeql/custom-queries/xss-vulnerability.ql:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ql",children:'/**\n * @name Cross-site scripting vulnerability\n * @description Finds potential XSS vulnerabilities in web applications\n * @kind path-problem\n * @problem.severity error\n * @security-severity 7.5\n * @precision high\n * @id custom/xss-vulnerability\n * @tags security\n *       external/cwe/cwe-79\n */\n\nimport javascript\nimport semmle.javascript.security.dataflow.DomBasedXssQuery\nimport DataFlow::PathGraph\n\n/**\n * A taint-tracking configuration for XSS vulnerabilities\n */\nclass XssConfig extends TaintTracking::Configuration {\n  XssConfig() { this = "XssConfig" }\n\n  override predicate isSource(DataFlow::Node source) {\n    // User input from various sources\n    source instanceof RemoteFlowSource or\n    // URL parameters\n    exists(UrlSearchParams usp | source = usp.getAMethodCall("get")) or\n    // Local storage\n    exists(WebStorageWrite write | source = write.getValue()) or\n    // Document location\n    source.asExpr().(PropAccess).accesses(any(GlobalVarAccess gva | gva.getName() = "location"), _)\n  }\n\n  override predicate isSink(DataFlow::Node sink) {\n    // DOM manipulation sinks\n    sink instanceof DomBasedXss::Sink or\n    // innerHTML assignments\n    exists(AssignmentExpr assign |\n      assign.getLhs().(PropAccess).getPropertyName() = "innerHTML" and\n      sink.asExpr() = assign.getRhs()\n    ) or\n    // document.write calls\n    exists(MethodCallExpr call |\n      call.getReceiver().(GlobalVarAccess).getName() = "document" and\n      call.getMethodName() = "write" and\n      sink.asExpr() = call.getAnArgument()\n    ) or\n    // jQuery html() method\n    exists(MethodCallExpr call |\n      call.getMethodName() = "html" and\n      call.getNumArgument() > 0 and\n      sink.asExpr() = call.getArgument(0)\n    )\n  }\n\n  override predicate isSanitizer(DataFlow::Node node) {\n    // HTML encoding/escaping functions\n    exists(MethodCallExpr call |\n      call.getMethodName().regexpMatch("(?i).*escape.*|.*encode.*|.*sanitize.*") and\n      node.asExpr() = call\n    ) or\n    // Text content assignments (safe)\n    exists(AssignmentExpr assign |\n      assign.getLhs().(PropAccess).getPropertyName() = "textContent" and\n      node.asExpr() = assign.getRhs()\n    )\n  }\n}\n\nfrom XssConfig config, DataFlow::PathNode source, DataFlow::PathNode sink\nwhere config.hasFlowPath(source, sink)\nselect sink.getNode(), source, sink,\n  "This DOM update depends on a $@, which could allow XSS attacks.",\n  source.getNode(), "user-provided value"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-step-5-advanced-codeql-analysis",children:"\ud83d\udd0d Step 5: Advanced CodeQL Analysis"}),"\n",(0,r.jsx)(n.h3,{id:"batch-analysis-script",children:"Batch Analysis Script"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Create batch-analysis.py:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n\nimport os\nimport subprocess\nimport json\nimport argparse\nfrom pathlib import Path\nimport concurrent.futures\nfrom datetime import datetime\n\nclass CodeQLBatchAnalyzer:\n    def __init__(self, codeql_path="codeql", queries_path="codeql-repo"):\n        self.codeql_path = codeql_path\n        self.queries_path = queries_path\n        self.results = []\n        \n    def create_database(self, source_path, language, database_name, build_command=None):\n        """Create CodeQL database for a project"""\n        print(f"Creating database for {source_path} ({language})")\n        \n        cmd = [\n            self.codeql_path, "database", "create", database_name,\n            f"--language={language}",\n            f"--source-root={source_path}"\n        ]\n        \n        if build_command:\n            cmd.extend(["--command", build_command])\n            \n        try:\n            result = subprocess.run(cmd, capture_output=True, text=True, check=True)\n            print(f"\u2705 Database created: {database_name}")\n            return True\n        except subprocess.CalledProcessError as e:\n            print(f"\u274c Failed to create database: {e.stderr}")\n            return False\n    \n    def run_analysis(self, database_name, language, query_suite="security-and-quality"):\n        """Run CodeQL analysis on a database"""\n        print(f"Running analysis on {database_name}")\n        \n        # Determine query path based on language\n        query_paths = {\n            "javascript": f"{self.queries_path}/javascript/ql/src/codeql-suites/javascript-{query_suite}.qls",\n            "python": f"{self.queries_path}/python/ql/src/codeql-suites/python-{query_suite}.qls",\n            "java": f"{self.queries_path}/java/ql/src/codeql-suites/java-{query_suite}.qls",\n            "csharp": f"{self.queries_path}/csharp/ql/src/codeql-suites/csharp-{query_suite}.qls",\n            "cpp": f"{self.queries_path}/cpp/ql/src/codeql-suites/cpp-{query_suite}.qls",\n            "go": f"{self.queries_path}/go/ql/src/codeql-suites/go-{query_suite}.qls"\n        }\n        \n        if language not in query_paths:\n            print(f"\u274c Unsupported language: {language}")\n            return None\n            \n        query_path = query_paths[language]\n        output_file = f"{database_name}-results.sarif"\n        \n        cmd = [\n            self.codeql_path, "database", "analyze", database_name,\n            query_path,\n            "--format=sarif-latest",\n            f"--output={output_file}"\n        ]\n        \n        try:\n            result = subprocess.run(cmd, capture_output=True, text=True, check=True)\n            print(f"\u2705 Analysis completed: {output_file}")\n            return output_file\n        except subprocess.CalledProcessError as e:\n            print(f"\u274c Analysis failed: {e.stderr}")\n            return None\n    \n    def parse_sarif_results(self, sarif_file):\n        """Parse SARIF results and extract key information"""\n        try:\n            with open(sarif_file, \'r\') as f:\n                sarif_data = json.load(f)\n            \n            results_summary = {\n                "file": sarif_file,\n                "total_results": 0,\n                "by_severity": {"error": 0, "warning": 0, "note": 0},\n                "by_rule": {},\n                "issues": []\n            }\n            \n            for run in sarif_data.get("runs", []):\n                for result in run.get("results", []):\n                    results_summary["total_results"] += 1\n                    \n                    # Count by severity\n                    level = result.get("level", "note")\n                    if level in results_summary["by_severity"]:\n                        results_summary["by_severity"][level] += 1\n                    \n                    # Count by rule\n                    rule_id = result.get("ruleId", "unknown")\n                    if rule_id not in results_summary["by_rule"]:\n                        results_summary["by_rule"][rule_id] = 0\n                    results_summary["by_rule"][rule_id] += 1\n                    \n                    # Extract issue details\n                    issue = {\n                        "rule_id": rule_id,\n                        "level": level,\n                        "message": result.get("message", {}).get("text", ""),\n                        "locations": []\n                    }\n                    \n                    for location in result.get("locations", []):\n                        physical_location = location.get("physicalLocation", {})\n                        artifact_location = physical_location.get("artifactLocation", {})\n                        region = physical_location.get("region", {})\n                        \n                        issue["locations"].append({\n                            "file": artifact_location.get("uri", ""),\n                            "line": region.get("startLine", 0),\n                            "column": region.get("startColumn", 0)\n                        })\n                    \n                    results_summary["issues"].append(issue)\n            \n            return results_summary\n            \n        except Exception as e:\n            print(f"\u274c Failed to parse SARIF file {sarif_file}: {e}")\n            return None\n    \n    def analyze_project(self, project_config):\n        """Analyze a single project"""\n        source_path = project_config["source_path"]\n        language = project_config["language"]\n        build_command = project_config.get("build_command")\n        project_name = project_config.get("name", Path(source_path).name)\n        \n        database_name = f"{project_name}-{language}-db"\n        \n        print(f"\\n\ud83d\udd0d Analyzing project: {project_name}")\n        print(f"   Source: {source_path}")\n        print(f"   Language: {language}")\n        \n        # Create database\n        if not self.create_database(source_path, language, database_name, build_command):\n            return None\n        \n        # Run analysis\n        sarif_file = self.run_analysis(database_name, language)\n        if not sarif_file:\n            return None\n        \n        # Parse results\n        results = self.parse_sarif_results(sarif_file)\n        if results:\n            results["project_name"] = project_name\n            results["language"] = language\n            results["source_path"] = source_path\n        \n        # Cleanup database\n        try:\n            subprocess.run(["rm", "-rf", database_name], check=True)\n        except:\n            pass\n        \n        return results\n    \n    def analyze_multiple_projects(self, projects_config, max_workers=4):\n        """Analyze multiple projects in parallel"""\n        print(f"\ud83d\ude80 Starting batch analysis of {len(projects_config)} projects")\n        \n        with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:\n            future_to_project = {\n                executor.submit(self.analyze_project, project): project \n                for project in projects_config\n            }\n            \n            for future in concurrent.futures.as_completed(future_to_project):\n                project = future_to_project[future]\n                try:\n                    result = future.result()\n                    if result:\n                        self.results.append(result)\n                        print(f"\u2705 Completed: {project.get(\'name\', \'Unknown\')}")\n                    else:\n                        print(f"\u274c Failed: {project.get(\'name\', \'Unknown\')}")\n                except Exception as e:\n                    print(f"\u274c Exception for {project.get(\'name\', \'Unknown\')}: {e}")\n    \n    def generate_report(self, output_file="codeql-batch-report.json"):\n        """Generate comprehensive report"""\n        report = {\n            "generated_at": datetime.now().isoformat(),\n            "total_projects": len(self.results),\n            "summary": {\n                "total_issues": sum(r["total_results"] for r in self.results),\n                "by_severity": {"error": 0, "warning": 0, "note": 0},\n                "by_language": {},\n                "top_rules": {}\n            },\n            "projects": self.results\n        }\n        \n        # Calculate summary statistics\n        for result in self.results:\n            # By severity\n            for severity, count in result["by_severity"].items():\n                report["summary"]["by_severity"][severity] += count\n            \n            # By language\n            language = result["language"]\n            if language not in report["summary"]["by_language"]:\n                report["summary"]["by_language"][language] = 0\n            report["summary"]["by_language"][language] += result["total_results"]\n            \n            # Top rules\n            for rule, count in result["by_rule"].items():\n                if rule not in report["summary"]["top_rules"]:\n                    report["summary"]["top_rules"][rule] = 0\n                report["summary"]["top_rules"][rule] += count\n        \n        # Sort top rules\n        report["summary"]["top_rules"] = dict(\n            sorted(report["summary"]["top_rules"].items(), \n                   key=lambda x: x[1], reverse=True)[:10]\n        )\n        \n        # Save report\n        with open(output_file, \'w\') as f:\n            json.dump(report, f, indent=2)\n        \n        print(f"\\n\ud83d\udcca Report generated: {output_file}")\n        \n        # Print summary\n        print("\\n" + "="*50)\n        print("CODEQL BATCH ANALYSIS SUMMARY")\n        print("="*50)\n        print(f"Projects analyzed: {report[\'total_projects\']}")\n        print(f"Total issues found: {report[\'summary\'][\'total_issues\']}")\n        print(f"Errors: {report[\'summary\'][\'by_severity\'][\'error\']}")\n        print(f"Warnings: {report[\'summary\'][\'by_severity\'][\'warning\']}")\n        print(f"Notes: {report[\'summary\'][\'by_severity\'][\'note\']}")\n        \n        print("\\nTop vulnerability types:")\n        for rule, count in list(report[\'summary\'][\'top_rules\'].items())[:5]:\n            print(f"  {rule}: {count}")\n        \n        print("="*50)\n\ndef main():\n    parser = argparse.ArgumentParser(description=\'CodeQL Batch Analyzer\')\n    parser.add_argument(\'config\', help=\'JSON configuration file with projects to analyze\')\n    parser.add_argument(\'--workers\', type=int, default=4, help=\'Number of parallel workers\')\n    parser.add_argument(\'--output\', default=\'codeql-batch-report.json\', help=\'Output report file\')\n    \n    args = parser.parse_args()\n    \n    # Load configuration\n    try:\n        with open(args.config, \'r\') as f:\n            config = json.load(f)\n    except Exception as e:\n        print(f"\u274c Failed to load configuration: {e}")\n        return 1\n    \n    # Initialize analyzer\n    analyzer = CodeQLBatchAnalyzer()\n    \n    # Run analysis\n    analyzer.analyze_multiple_projects(config.get("projects", []), args.workers)\n    \n    # Generate report\n    analyzer.generate_report(args.output)\n    \n    return 0\n\nif __name__ == "__main__":\n    exit(main())\n'})}),"\n",(0,r.jsx)(n.h3,{id:"batch-configuration-example",children:"Batch Configuration Example"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Create batch-config.json:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "projects": [\n    {\n      "name": "web-frontend",\n      "source_path": "./frontend",\n      "language": "javascript",\n      "build_command": "npm install && npm run build"\n    },\n    {\n      "name": "api-backend",\n      "source_path": "./backend",\n      "language": "python",\n      "build_command": "pip install -r requirements.txt"\n    },\n    {\n      "name": "mobile-app",\n      "source_path": "./mobile",\n      "language": "java",\n      "build_command": "gradle build"\n    },\n    {\n      "name": "microservice-auth",\n      "source_path": "./services/auth",\n      "language": "go",\n      "build_command": "go mod download && go build"\n    }\n  ],\n  "settings": {\n    "query_suite": "security-extended",\n    "max_workers": 4,\n    "cleanup_databases": true\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-common-use-cases",children:"\ud83d\udccb Common Use Cases"}),"\n",(0,r.jsxs)(n.h3,{id:"1-security-research",children:["1. ",(0,r.jsx)(n.strong,{children:"Security Research"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Custom vulnerability pattern detection"}),"\n",(0,r.jsx)(n.li,{children:"Zero-day vulnerability discovery"}),"\n",(0,r.jsx)(n.li,{children:"Security rule development and testing"}),"\n",(0,r.jsx)(n.li,{children:"Advanced threat modeling"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"2-enterprise-security",children:["2. ",(0,r.jsx)(n.strong,{children:"Enterprise Security"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Large-scale codebase analysis"}),"\n",(0,r.jsx)(n.li,{children:"Compliance and audit preparation"}),"\n",(0,r.jsx)(n.li,{children:"Security gate implementation"}),"\n",(0,r.jsx)(n.li,{children:"Developer security training"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"3-devsecops-integration",children:["3. ",(0,r.jsx)(n.strong,{children:"DevSecOps Integration"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Automated security scanning in CI/CD"}),"\n",(0,r.jsx)(n.li,{children:"Pull request security checks"}),"\n",(0,r.jsx)(n.li,{children:"Continuous security monitoring"}),"\n",(0,r.jsx)(n.li,{children:"Security metrics and reporting"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"4-code-quality-assurance",children:["4. ",(0,r.jsx)(n.strong,{children:"Code Quality Assurance"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Bug pattern detection"}),"\n",(0,r.jsx)(n.li,{children:"Code smell identification"}),"\n",(0,r.jsx)(n.li,{children:"Maintainability analysis"}),"\n",(0,r.jsx)(n.li,{children:"Technical debt assessment"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-what-youll-achieve",children:"\u2705 What You'll Achieve"}),"\n",(0,r.jsx)(n.p,{children:"After following this guide, you'll have:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\ud83c\udfd7\ufe0f Advanced Security Analysis"})," - Semantic code analysis with CodeQL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udd0d Custom Vulnerability Detection"})," - Custom queries for specific security patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\ude80 CI/CD Integration"})," - Automated security scanning in GitHub Actions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udcca Comprehensive Reporting"})," - Detailed security analysis reports"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udee1\ufe0f Security Research Capabilities"})," - Advanced query development and testing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udcc8 Batch Analysis"})," - Large-scale multi-project security analysis"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udd04 Continuous Security"})," - Ongoing security monitoring and improvement"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udc65 Developer Education"})," - Security-aware development practices"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"CodeQL is now configured for your advanced semantic security analysis workflows!"})]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(6540);const r={},a=s.createContext(r);function i(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);